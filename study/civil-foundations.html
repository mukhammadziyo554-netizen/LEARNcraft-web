<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#000000">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Foundations - Civil Engineering - LEARNcraft</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html, body {
            width: 100%;
            height: 100%;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background: radial-gradient(circle at top, #0a0a0a 0%, #000000 60%, #000000 100%);
            color: #ffffff;
            min-height: 100vh;
            overflow-x: hidden;
        }

        .page-wrapper {
            width: 100%;
            min-height: 100vh;
            padding: 80px 20px 60px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
        }

        .back-button {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 10px 16px;
            background: transparent;
            border: none;
            color: #888;
            text-decoration: none;
            font-weight: 500;
            font-size: 14px;
            cursor: pointer;
            transition: color 0.3s;
            margin-bottom: 50px;
        }

        .back-button:hover {
            color: #ffffff;
        }

        .page-header {
            margin-bottom: 60px;
        }

        .stage-title {
            font-size: 48px;
            font-weight: 700;
            color: #FFD84D;
            margin-bottom: 8px;
        }

        .stage-subtitle {
            font-size: 24px;
            font-weight: 400;
            color: #bdbdbd;
        }

        .section {
            margin-bottom: 60px;
        }

        .section-title {
            font-size: 28px;
            font-weight: 700;
            color: #ffffff;
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 2px solid rgba(255, 215, 0, 0.3);
        }

        .section-content {
            font-size: 16px;
            line-height: 1.8;
            color: #EAEAEA;
        }

        .section-content p {
            margin-bottom: 16px;
        }

        .table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }

        .table th,
        .table td {
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 12px 16px;
            text-align: left;
        }

        .table th {
            background: rgba(255, 216, 77, 0.1);
            color: #FFD84D;
            font-weight: 600;
        }

        .table tr:hover {
            background: rgba(255, 216, 77, 0.05);
        }

        .list-item {
            margin: 12px 0 12px 20px;
            color: #EAEAEA;
            line-height: 1.7;
        }

        .list-item::before {
            content: "‚ñ∏ ";
            color: #FFD84D;
            font-weight: bold;
            margin-right: 8px;
        }

        .week-plan {
            background: rgba(255, 216, 77, 0.05);
            border-left: 4px solid #FFD84D;
            padding: 20px;
            border-radius: 8px;
            margin: 16px 0;
        }

        .week-title {
            color: #FFD84D;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .week-content {
            color: #EAEAEA;
            line-height: 1.6;
        }

        .ask-ai-section {
            margin-top: 80px;
            padding: 40px;
            background: rgba(255, 216, 77, 0.08);
            border: 2px solid rgba(255, 216, 77, 0.3);
            border-radius: 16px;
            text-align: center;
        }

        .ask-ai-title {
            font-size: 24px;
            font-weight: 700;
            color: #FFD84D;
            margin-bottom: 16px;
        }

        .ask-ai-button {
            display: inline-block;
            padding: 16px 48px;
            background: #FFD84D;
            color: #000000;
            border: none;
            border-radius: 12px;
            font-weight: 700;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 0 40px rgba(255, 216, 77, 0.3);
        }

        .ask-ai-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 50px rgba(255, 216, 77, 0.5);
        }

        /* ===== PROGRESS TRACKING SECTION ===== */
        .stage-progress-section {
            margin-top: 80px;
            padding-bottom: 40px;
        }

        .start-stage-btn {
            background: linear-gradient(90deg, #ffd84d, #ffb700);
            border: none;
            padding: 14px 32px;
            font-weight: 700;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            color: #000000;
            transition: all 0.3s ease;
            box-shadow: 0 0 20px rgba(255, 216, 77, 0.2);
            margin-bottom: 30px;
            width: 100%;
        }

        .start-stage-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 0 35px rgba(255, 216, 77, 0.4);
        }

        .start-stage-btn:active {
            transform: scale(0.98);
        }

        .hidden {
            display: none !important;
        }

        #progressDashboard {
            background: rgba(255, 216, 77, 0.05);
            border: 2px solid rgba(255, 216, 77, 0.2);
            border-radius: 12px;
            padding: 30px;
            margin-top: 30px;
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        #progressDashboard h2 {
            font-size: 28px;
            font-weight: 700;
            color: #FFD84D;
            margin-bottom: 24px;
        }

        .stats-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 24px 0;
            font-weight: 600;
            font-size: 16px;
        }

        .stats-row div {
            background: rgba(255, 216, 77, 0.08);
            padding: 16px;
            border-radius: 8px;
            border-left: 3px solid #FFD84D;
            color: #EAEAEA;
        }

        .stats-row span {
            color: #FFD84D;
            font-weight: 700;
        }

        .progress-bar {
            width: 100%;
            height: 14px;
            background: #222;
            border-radius: 8px;
            margin: 24px 0;
            overflow: hidden;
        }

        #progressFill {
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, #ffd84d, #ffb700);
            transition: width 0.4s ease;
            border-radius: 8px;
            box-shadow: 0 0 20px rgba(255, 216, 77, 0.4);
        }

        .tracker-table {
            width: 100%;
            border-collapse: collapse;
            color: white;
            margin: 24px 0;
            font-size: 14px;
        }

        .tracker-table th,
        .tracker-table td {
            border: 1px solid #333;
            padding: 12px 8px;
            text-align: center;
        }

        .tracker-table th {
            background: rgba(255, 216, 77, 0.1);
            color: #FFD84D;
            font-weight: 700;
        }

        .tracker-table td:first-child {
            text-align: left;
            padding-left: 16px;
        }

        .tracker-table tr:hover {
            background: rgba(255, 216, 77, 0.05);
        }

        .tracker-table input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
            accent-color: #FFD84D;
        }

        .mental-state {
            margin: 28px 0;
            padding: 20px;
            background: rgba(255, 216, 77, 0.05);
            border-radius: 8px;
        }

        .mental-state label {
            display: inline-block;
            margin-right: 16px;
            font-weight: 600;
            color: #EAEAEA;
            margin-bottom: 12px;
        }

        .mental-state select {
            padding: 8px 12px;
            background: #222;
            color: #FFD84D;
            border: 1px solid #333;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            margin-right: 24px;
            margin-bottom: 12px;
        }

        .mental-state select:hover {
            border-color: #FFD84D;
        }

        #progressChart {
            max-width: 100%;
            margin: 30px 0;
        }

        @media (max-width: 768px) {
            .page-wrapper {
                padding: 60px 16px 50px;
            }

            .stage-title {
                font-size: 36px;
            }

            .stage-subtitle {
                font-size: 18px;
            }

            .section-title {
                font-size: 22px;
            }

            .section-content {
                font-size: 15px;
            }

            .ask-ai-section {
                padding: 30px 20px;
            }

            .ask-ai-button {
                padding: 14px 40px;
                font-size: 15px;
                width: 100%;
            }

            /* Progress tracking responsive */
            #progressDashboard {
                padding: 20px;
            }

            #progressDashboard h2 {
                font-size: 22px;
                margin-bottom: 16px;
            }

            .stats-row {
                grid-template-columns: 1fr;
                gap: 12px;
                font-size: 14px;
            }

            .tracker-table {
                font-size: 12px;
            }

            .tracker-table th,
            .tracker-table td {
                padding: 8px 4px;
            }

            .tracker-table input[type="checkbox"] {
                width: 18px;
                height: 18px;
            }

            .mental-state {
                display: flex;
                flex-direction: column;
                gap: 10px;
            }

            .mental-state label {
                margin-right: 0;
                margin-bottom: 4px;
            }

            .mental-state select {
                margin-right: 0;
                margin-bottom: 8px;
                width: 100%;
            }

            .start-stage-btn {
                padding: 12px 28px;
                font-size: 15px;
            }
        }

        @media (max-width: 480px) {
            .page-wrapper {
                padding: 50px 12px 40px;
            }

            .stage-title {
                font-size: 28px;
            }

            .stage-subtitle {
                font-size: 16px;
            }

            .section-title {
                font-size: 18px;
            }

            .section-content {
                font-size: 14px;
            }

            .ask-ai-button {
                padding: 12px 24px;
                font-size: 14px;
            }

            /* Progress tracking responsive for small screens */
            #progressDashboard {
                padding: 16px;
                margin-top: 20px;
                border-radius: 8px;
            }

            #progressDashboard h2 {
                font-size: 18px;
                margin-bottom: 12px;
            }

            .stats-row {
                grid-template-columns: 1fr;
                gap: 8px;
                font-size: 13px;
                margin: 16px 0;
            }

            .stats-row div {
                padding: 12px;
                border-left-width: 2px;
            }

            .progress-bar {
                height: 12px;
                margin: 16px 0;
            }

            .tracker-table {
                font-size: 11px;
                margin: 16px 0;
            }

            .tracker-table th,
            .tracker-table td {
                padding: 6px 3px;
            }

            .tracker-table td:first-child {
                font-size: 10px;
            }

            .tracker-table input[type="checkbox"] {
                width: 16px;
                height: 16px;
            }

            .mental-state {
                padding: 12px;
                margin: 16px 0;
            }

            .mental-state label {
                font-size: 13px;
            }

            .mental-state select {
                font-size: 12px;
                padding: 6px 8px;
            }

            .start-stage-btn {
                padding: 11px 24px;
                font-size: 14px;
                margin-bottom: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="page-wrapper">
        <div class="container">
            <button onclick="window.history.back()" class="back-button">‚Üê Back</button>

            <div class="page-header">
                <h1 class="stage-title">Foundations</h1>
                <p class="stage-subtitle">Civil Engineering</p>
            </div>

            <div class="section">
                <h2 class="section-title">What You Will Learn</h2>
                <div class="section-content">
                    <p>In this foundational stage, you'll build the mathematical and physical knowledge required for civil engineering. You'll develop strong skills in algebra, geometry, and physics that form the backbone of all engineering disciplines.</p>
                    <p>By the end of this stage, you'll be able to:</p>
                    <div class="list-item">Solve complex algebraic equations and systems</div>
                    <div class="list-item">Understand geometric concepts and spatial reasoning</div>
                    <div class="list-item">Apply Newton's laws and basic physics principles</div>
                    <div class="list-item">Perform accurate measurements and unit conversions</div>
                    <div class="list-item">Analyze forces and motion in engineering contexts</div>
                </div>
            </div>

            <div class="section">
                <h2 class="section-title">Prerequisites (Grade Level)</h2>
                <div class="section-content">
                    <p>The following table shows the recommended grade level and prior knowledge for each topic:</p>
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Topic</th>
                                <th>Recommended Grade</th>
                                <th>Prior Knowledge</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Algebra Fundamentals</td>
                                <td>Grade 8‚Äì9</td>
                                <td>Basic arithmetic, exponents</td>
                            </tr>
                            <tr>
                                <td>Geometry & Trigonometry</td>
                                <td>Grade 9‚Äì10</td>
                                <td>Algebra basics, area/volume</td>
                            </tr>
                            <tr>
                                <td>Basic Physics</td>
                                <td>Grade 9‚Äì10</td>
                                <td>Force, motion, energy concepts</td>
                            </tr>
                            <tr>
                                <td>Units & Measurement</td>
                                <td>Grade 10</td>
                                <td>Metric system, conversions</td>
                            </tr>
                            <tr>
                                <td>Engineering Math</td>
                                <td>Grade 10‚Äì11</td>
                                <td>Calculus foundations</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="section">
                <h2 class="section-title">How to Study</h2>
                <div class="section-content">
                    <p>Follow this proven learning methodology to maximize retention and understanding:</p>
                    <div style="margin: 20px 0;">
                        <div class="list-item"><strong>Step 1: Learn Theory</strong> ‚Äî Watch video lectures and read textbooks on each topic. Take notes on key concepts and formulas.</div>
                        <div class="list-item"><strong>Step 2: Practice Problems</strong> ‚Äî Solve 20-30 practice problems for each topic. Start with easier problems and progress to harder ones.</div>
                        <div class="list-item"><strong>Step 3: Apply to Engineering</strong> ‚Äî Connect each concept to real civil engineering applications (bridges, buildings, etc.).</div>
                        <div class="list-item"><strong>Step 4: Ask AI Questions</strong> ‚Äî Use the LEARNcraft AI chat to clarify confusing topics, get problem hints, or discuss real-world examples.</div>
                    </div>
                </div>
            </div>

            <div class="section">
                <h2 class="section-title">Weekly Study Plan</h2>
                <div class="section-content">
                    <p>Dedicate 5-8 hours per week to complete this stage in 4 weeks. Here's a recommended schedule:</p>

                    <div class="week-plan">
                        <div class="week-title">Week 1: Algebra Review & Equations</div>
                        <div class="week-content">
                            Master linear and quadratic equations. Topics: solving for unknowns, systems of equations, graphing linear functions. Practice: 25 problems.
                        </div>
                    </div>

                    <div class="week-plan">
                        <div class="week-title">Week 2: Geometry, Trigonometry & Units</div>
                        <div class="week-content">
                            Learn properties of shapes, triangles, and trigonometric functions. Understand unit systems and conversions. Practice: 30 problems.
                        </div>
                    </div>

                    <div class="week-plan">
                        <div class="week-title">Week 3: Physics Fundamentals</div>
                        <div class="week-content">
                            Newton's laws, forces, motion, energy, and work. Apply concepts to real structures and systems. Practice: 30 problems.
                        </div>
                    </div>

                    <div class="week-plan">
                        <div class="week-title">Week 4: Engineering Applications & Review</div>
                        <div class="week-content">
                            Real-world civil engineering problems combining all previous topics. Complete comprehensive practice exam and review weak areas.
                        </div>
                    </div>
                </div>
            </div>

            <div class="ask-ai-section">
                <h2 class="ask-ai-title">Questions About This Stage?</h2>
                <p style="font-size: 16px; color: #bdbdbd; margin-bottom: 24px;">
                    Get personalized help from LEARNcraft's AI tutor. Ask anything about the material, request problem solutions, or discuss concepts.
                </p>
                <button class="ask-ai-button">Ask AI About This Stage</button>
            </div>

            <!-- PROGRESS TRACKING SECTION -->
            <section class="stage-progress-section">
                <button class="start-stage-btn" onclick="startStage()">START STAGE & TRACK PROGRESS</button>

                <div id="progressDashboard" class="hidden">
                    <h2>Your Study Progress</h2>

                    <!-- Progress Stats -->
                    <div class="stats-row">
                        <div>üìÖ Weekly Completion: <span id="weeklyPercent">0%</span></div>
                        <div>üéØ Stage Progress: <span id="stagePercent">0%</span></div>
                        <div>üî• Study Streak: <span id="streakCount">0</span> days</div>
                    </div>

                    <!-- Progress Bar -->
                    <div class="progress-bar">
                        <div id="progressFill"></div>
                    </div>

                    <!-- Learning Task Grid -->
                    <table class="tracker-table" id="trackerTable">
                        <tr>
                            <th>Task</th>
                            <th>Mon</th><th>Tue</th><th>Wed</th>
                            <th>Thu</th><th>Fri</th><th>Sat</th><th>Sun</th>
                        </tr>

                        <tr>
                            <td>Study Algebra</td>
                            <td><input type="checkbox"></td><td><input type="checkbox"></td>
                            <td><input type="checkbox"></td><td><input type="checkbox"></td>
                            <td><input type="checkbox"></td><td><input type="checkbox"></td>
                            <td><input type="checkbox"></td>
                        </tr>

                        <tr>
                            <td>Physics Basics</td>
                            <td><input type="checkbox"></td><td><input type="checkbox"></td>
                            <td><input type="checkbox"></td><td><input type="checkbox"></td>
                            <td><input type="checkbox"></td><td><input type="checkbox"></td>
                            <td><input type="checkbox"></td>
                        </tr>

                        <tr>
                            <td>Watch Lesson</td>
                            <td><input type="checkbox"></td><td><input type="checkbox"></td>
                            <td><input type="checkbox"></td><td><input type="checkbox"></td>
                            <td><input type="checkbox"></td><td><input type="checkbox"></td>
                            <td><input type="checkbox"></td>
                        </tr>

                        <tr>
                            <td>Solve Problems</td>
                            <td><input type="checkbox"></td><td><input type="checkbox"></td>
                            <td><input type="checkbox"></td><td><input type="checkbox"></td>
                            <td><input type="checkbox"></td><td><input type="checkbox"></td>
                            <td><input type="checkbox"></td>
                        </tr>

                        <tr>
                            <td>Ask AI Questions</td>
                            <td><input type="checkbox"></td><td><input type="checkbox"></td>
                            <td><input type="checkbox"></td><td><input type="checkbox"></td>
                            <td><input type="checkbox"></td><td><input type="checkbox"></td>
                            <td><input type="checkbox"></td>
                        </tr>
                    </table>

                    <!-- Mood + Motivation -->
                    <div class="mental-state">
                        <label>Mood:</label>
                        <select id="moodSelect">
                            <option value="">Select mood...</option>
                            <option value="1">1 - Very Poor</option>
                            <option value="2">2 - Poor</option>
                            <option value="3">3 - Neutral</option>
                            <option value="4">4 - Good</option>
                            <option value="5">5 - Excellent</option>
                        </select>

                        <label>Motivation:</label>
                        <select id="motivationSelect">
                            <option value="">Select motivation...</option>
                            <option value="1">1 - Very Low</option>
                            <option value="2">2 - Low</option>
                            <option value="3">3 - Average</option>
                            <option value="4">4 - High</option>
                            <option value="5">5 - Very High</option>
                        </select>
                    </div>

                    <!-- Graph -->
                    <canvas id="progressChart" height="100"></canvas>
                </div>
            </section>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        if (typeof TelegramWebApp !== 'undefined') {
            const tg = window.Telegram.WebApp;
            tg.ready();
            tg.setHeaderColor('#000000');
            tg.setBackgroundColor('#000000');
            tg.MainButton.hide();
        }

        // Progress tracking variables
        let streak = 0;
        let progressHistory = [];
        let chart = null;

        function startStage() {
            document.getElementById("progressDashboard").classList.remove("hidden");
            loadProgressFromStorage();
            initializeChart();
        }

        // Initialize checkboxes and event listeners
        function initializeCheckboxes() {
            const checkboxes = document.querySelectorAll('#trackerTable input[type="checkbox"]');
            checkboxes.forEach(box => {
                box.addEventListener("change", updateProgress);
                // Load saved state
                const savedState = localStorage.getItem(box.dataset.id);
                if (savedState) {
                    box.checked = JSON.parse(savedState);
                }
            });
        }

        function updateProgress() {
            const checkboxes = document.querySelectorAll('#trackerTable input[type="checkbox"]');
            const total = checkboxes.length;
            const checked = document.querySelectorAll('#trackerTable input[type="checkbox"]:checked').length;

            const percent = Math.round((checked / total) * 100);
            document.getElementById("stagePercent").textContent = percent + "%";
            document.getElementById("progressFill").style.width = percent + "%";
            document.getElementById("weeklyPercent").textContent = percent + "%";

            // Update streak
            if (checked > 0 && streak === 0) {
                streak = 1;
            } else if (checked > 0) {
                streak = Math.floor(checked / 5); // Simulate streak based on tasks
            } else {
                streak = 0;
            }
            document.getElementById("streakCount").textContent = streak;

            // Save to localStorage
            progressHistory.push(percent);
            saveProgressToStorage();
            updateChart();

            // Save checkbox states
            checkboxes.forEach((box, idx) => {
                localStorage.setItem(`checkbox-${idx}`, box.checked);
            });
        }

        function saveProgressToStorage() {
            localStorage.setItem("learnProgress", JSON.stringify(progressHistory));
            const mood = document.getElementById("moodSelect").value;
            const motivation = document.getElementById("motivationSelect").value;
            localStorage.setItem("learnMood", mood);
            localStorage.setItem("learnMotivation", motivation);
        }

        function loadProgressFromStorage() {
            const saved = localStorage.getItem("learnProgress");
            if (saved) {
                progressHistory = JSON.parse(saved);
            }

            const savedMood = localStorage.getItem("learnMood");
            if (savedMood) {
                document.getElementById("moodSelect").value = savedMood;
            }

            const savedMotivation = localStorage.getItem("learnMotivation");
            if (savedMotivation) {
                document.getElementById("motivationSelect").value = savedMotivation;
            }

            initializeCheckboxes();
        }

        function initializeChart() {
            if (chart !== null) {
                return; // Chart already initialized
            }

            const ctx = document.getElementById('progressChart');
            if (!ctx) return;

            const canvasContext = ctx.getContext('2d');
            
            const labels = progressHistory.map((_, idx) => "Day " + (idx + 1));

            chart = new Chart(canvasContext, {
                type: 'line',
                data: {
                    labels: labels.length > 0 ? labels : ["Start"],
                    datasets: [{
                        label: 'Learning Progress',
                        data: progressHistory.length > 0 ? progressHistory : [0],
                        borderColor: '#ffd84d',
                        backgroundColor: 'rgba(255,216,77,0.2)',
                        fill: true,
                        tension: 0.4,
                        pointBackgroundColor: '#ffd84d',
                        pointBorderColor: '#ffb700',
                        pointRadius: 5,
                        pointHoverRadius: 7
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            labels: {
                                color: '#bdbdbd',
                                font: {
                                    weight: 'bold'
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            ticks: {
                                color: '#bdbdbd',
                                callback: function(value) {
                                    return value + '%';
                                }
                            },
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            }
                        },
                        x: {
                            ticks: {
                                color: '#bdbdbd'
                            },
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            }
                        }
                    }
                }
            });
        }

        function updateChart() {
            if (!chart) return;
            
            chart.data.labels.push("Day " + progressHistory.length);
            chart.data.datasets[0].data = progressHistory;
            chart.update();
        }

        // Save mood and motivation on change
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById("moodSelect").addEventListener("change", saveProgressToStorage);
            document.getElementById("motivationSelect").addEventListener("change", saveProgressToStorage);
        });
    </script>
    <script type="module">
        import { requireAuth } from "../auth.js";
        requireAuth();
    </script>
</body>
</html>